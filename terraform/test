# Security Group For Consul Service

resource "aws_security_group" "consul_security_group" {
      name = "consul_security_group"
      vpc_id = module.vpc_module.vpc_id
      tags = {
          Name = "consul_security_group"
      }
}

esource "aws_security_group_rule" "consul_inside_all" {
    from_port   = 0
    to_port     = 0
    protocol = "-1"
    type= "ingress"
    self = true
    security_group_id = aws_security_group.consul_security_group.id
    description = "Allow all inside security group "
}

resource "aws_security_group_rule" "lb_incomming" {
    from_port   = 80
    to_port     = 80
    protocol = "tcp"
    type= "ingress"
    security_group_id = aws_security_group.consul_security_group.id
    cidr_blocks = ["0.0.0.0/0"]
    description = "Allow access out "
}

resource "aws_security_group_rule" "consul_ping" {
    from_port   = 8
    to_port     = 0
    protocol = "icmp"
    type= "ingress"
    security_group_id = aws_security_group.consul_security_group.id
    self = true
    description = "Allow ping "
}

resource "aws_security_group_rule" "consul_ssh_acess" {
    description       = "allow ssh access from anywhere"
    from_port         = 22
    protocol          = "tcp"
    security_group_id = aws_security_group.consul_security_group.id
    to_port           = 22
    type              = "ingress"
    cidr_blocks       = ["0.0.0.0/0"]
}

resource "aws_security_group_rule" "consul_ui_acess1" {
    description       = "Allow consul UI access from 8500"
    from_port         = 8500
    protocol          = "tcp"
    security_group_id = aws_security_group.consul_security_group.id
    to_port           = 8500
    type              = "ingress"
    cidr_blocks       = ["0.0.0.0/0"]
}

resource "aws_security_group_rule" "consul_ui_acess2" {
    description       = "Allow consul UI access from 8300"
    from_port         = 8300
    protocol          = "tcp"
    security_group_id = aws_security_group.consul_security_group.id
    to_port           = 8300
    type              = "ingress"
    cidr_blocks       = ["0.0.0.0/0"]
}

resource "aws_security_group_rule" "consul_ui_acess3" {
    description       = "Allow consul UI access from 8301 tcp"
    from_port         = 8301
    protocol          = "tcp"
    security_group_id = aws_security_group.consul_security_group.id
    to_port           = 8301
    type              = "ingress"
    cidr_blocks       = ["0.0.0.0/0"]
}

resource "aws_security_group_rule" "consul_ui_acess4" {
    description       = "Allow consul UI access from 8301 udp"
    from_port         = 8301
    protocol          = "udp"
    security_group_id = aws_security_group.consul_security_group.id
    to_port           = 8301
    type              = "egress"
    cidr_blocks       = ["0.0.0.0/0"]
}

resource "aws_security_group_rule" "consul_ui_acess5" {
    description       = "Allow consul UI access from 8600 tcp"
    from_port         = 8600
    protocol          = "tcp"
    security_group_id = aws_security_group.consul_security_group.id
    to_port           = 8600
    type              = "ingress"
    cidr_blocks       = ["0.0.0.0/0"]
}

resource "aws_security_group_rule" "consul_ui_acess6" {
    description       = "Allow consul UI access from 8600 udp"
    from_port         = 8600
    protocol          = "udp"
    security_group_id = aws_security_group.consul_security_group.id
    to_port           = 8600
    type              = "egress"
    cidr_blocks       = ["0.0.0.0/0"]
}
